
<!DOCTYPE html>
<html>


<head>

  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lauren Yamane on Matrix Population Models in R</title>
  <link rel="canonical" href="/archives/2012-11-30-lauren-yamane-on-matrix-population-models/" />

  
  <link rel="stylesheet" href="/assets/css/kube.css" />
  <link rel="stylesheet" href="/assets/css/custom.css" />
  <link rel="stylesheet" href="/assets/css/tufte.css" />

  
  <link href='https://fonts.googleapis.com/css?family=Alegreya:400italic,400,700,700italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Alegreya+SC:400&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=IM+Fell+English:400,400i&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <link href="/assets/fonts/fell-flowers/style.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hack-font@3/build/web/hack-subset.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.0/css/academicons.min.css">
  <link href="/assets/fonts/fontawesome/css/all.css" rel="stylesheet">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="shortcut icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="shortcut icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="manifest" href="/assets/site.webmanifest">
  <link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="theme-color" content="#ffffff">

  
  

  
  <meta name="description" content="Last week in [Davis R Users&#39; Group](http://www.noamross.net/davis-r-users-group.html), Lauren Yamane showed us how she created and analyzed a stochastic age-structured population in R. Her examples are below. Her original scripts can be found as `*.Rmd` files [here](https://gist.github.com/4197507) A note to UC Davis students: This topic and others will be covered by Marissa Baskett and Sebastian Schreiber in their course this winter, *Computational methods in population biology* (ECL298) * * * * * A discrete time, age-structured model of a salmon population (semelparous) that can live to age 5, with fishing and environmental stochasticity ----------------------------------------------------------------------------------------------------------------------------------------------- Parameter values ~~~~ {.
" />

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="/archives/2012-11-30-lauren-yamane-on-matrix-population-models/">
  <meta name="twitter:title" content="Lauren Yamane on Matrix Population Models in R">
  <meta name="twitter:description" content="Last week in [Davis R Users&#39; Group](http://www.noamross.net/davis-r-users-group.html), Lauren Yamane showed us how she created and analyzed a stochastic age-structured population in R. Her examples are below. Her original scripts can be found as `*.Rmd` files [here](https://gist.github.com/4197507) A note to UC Davis students: This topic and others will be covered by Marissa Baskett and Sebastian Schreiber in their course this winter, *Computational methods in population biology* (ECL298) * * * * * A discrete time, age-structured model of a salmon population (semelparous) that can live to age 5, with fishing and environmental stochasticity ----------------------------------------------------------------------------------------------------------------------------------------------- Parameter values ~~~~ {.">
  <meta name="twitter:image" content="/assets/img/nr.png">
  <meta name="twitter:site" content="trang1618.github.io">
  <meta name="twitter:creator" content="@trang1618">

  <meta property="og:title" content="Lauren Yamane on Matrix Population Models in R" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:site_name" content="trang1618.github.io" />
  <meta property="og:description" content="  Last week in [Davis R Users&#39; Group](http://www.noamross.net/davis-r-users-group.html), Lauren Yamane showed us how she created and analyzed a stochastic age-structured population in R. Her examples are below. Her original scripts can be found as `*.Rmd` files [here](https://gist.github.com/4197507) A note to UC Davis students: This topic and others will be covered by Marissa Baskett and Sebastian Schreiber in their course this winter, *Computational methods in population biology* (ECL298) * * * * * A discrete time, age-structured model of a salmon population (semelparous) that can live to age 5, with fishing and environmental stochasticity ----------------------------------------------------------------------------------------------------------------------------------------------- Parameter values ~~~~ {." />
  <meta property="og:url" content="/archives/2012-11-30-lauren-yamane-on-matrix-population-models/" />
  <script type="application/ld+json">
    {"@type":"WebSite","url":"\/archives\/2012-11-30-lauren-yamane-on-matrix-population-models\/","headline":"Lauren Yamane on Matrix Population Models in R", "name":"trang1618.github.io","description":"Last week in [Davis R Users\x27 Group](http:\/\/www.noamross.net\/davis-r-users-group.html), Lauren Yamane showed us how she created and analyzed a stochastic age-structured population in R. Her examples are below. Her original scripts can be found as `*.Rmd` files [here](https:\/\/gist.github.com\/4197507) A note to UC Davis students: This topic and others will be covered by Marissa Baskett and Sebastian Schreiber in their course this winter, *Computational methods in population biology* (ECL298) * * * * * A discrete time, age-structured model of a salmon population (semelparous) that can live to age 5, with fishing and environmental stochasticity ----------------------------------------------------------------------------------------------------------------------------------------------- Parameter values ~~~~ {.","@context":"http://schema.org"}
  </script>

  
  
</head>

<body>

<div id="topbar" class="is-hidden-print">
	<div class="wrapper">
		<header>
			<div class="is-navbar-container">
				<nav>
				<div class="is-brand">
					<a href="/">t  r  a  n  g </a>
					<a href="#"
						 class="is-push-right-mobile is-shown-mobile icon-kube-menu"
						 data-kube="toggle"
						 data-target="#navbar-main"></a>
				</div>
				</nav>
				<div id="navbar-main" class="is-navbar is-hidden-mobile is-center-mobile">
					<nav>
						<ul>
							<li><a href="/blog">blog</a></li>
						
							<li><a href="/vitae">vitae</a></li>
							<li><a href="#connect">connect</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</header>
	</div>
</div>


<div class="wrapper">
  <div class="is-row is-stack-20">
    <div class="is-col is-10">&nbsp;</div>
    <div class="is-col is-60">
    <h1 class="is-text-center"><a href="">Lauren Yamane on Matrix Population Models in R</a></h1>
    <h4 class="is-bigger is-text-center">November 30, 2012</h4>
    </div>
    <div class="is-col is-30">&nbsp;</div>
  </div>
  <div class="is-row is-stack-20">
  </div>
  <div class="is-row is-stack-20">
    <div class="is-col is-10 dateblock is-stack-20">
    </div>
    <div class="is-col is-60">
      <div class="story">
       


Last week in [Davis R Users'
Group](http://www.noamross.net/davis-r-users-group.html), Lauren Yamane
showed us how she created and analyzed a stochastic age-structured
population in R. Her examples are below. Her original scripts can be
found as `*.Rmd` files [here](https://gist.github.com/4197507)

A note to UC Davis students: This topic and others will be covered by
Marissa Baskett and Sebastian Schreiber in their course this winter,
*Computational methods in population biology* (ECL298)

* * * * *

A discrete time, age-structured model of a salmon population (semelparous) that can live to age 5, with fishing and environmental stochasticity
-----------------------------------------------------------------------------------------------------------------------------------------------

Parameter values

~~~~ {.r}
a = 60  #alpha for Beverton-Holt stock-recruitment curve
b = 0.00017  #beta for Beverton-Holt
tf = 2000  #number of time steps
N0 = c(100, 0, 0, 0, 0)  #initial population vector for 5 age classes
s = 0.28  #survival rate with fishing
e = 0.1056  #fraction of age 3 fish that spawn early (age 4 is mean spawner age)
l = 0.1056  #fraction of age 4 fish that spawn late as age 5 fish
sx = c(s, s, (s * (1 - e)), (s * (l)))  #survival vector for all ages with fishing, spawners die after spawning
t <- 1  #start off at time=1
~~~~

Make a function for the age-structured matrix

~~~~ {.r}
# Make a function for the age-structured matrix with fishing
AgeStructMatrix_F = function(sx, a, b, tf, N0) {
    sig_r = 0.3
    ncls = length(N0)  #Number of age classes
    Nt_F = matrix(0, tf, ncls)  #Initialize output matrix with time steps as rows, age classes as columns
    Nt_F[1, ] = N0  #put initial values into first row of output matrix
    for (t in 1:(tf - 1)) {
        #for time step t in 1:1999
        Pt = (e * Nt_F[t, 3]) + ((1 - l) * Nt_F[t, 4]) + Nt_F[t, 5]  #number of spawners
        Nt_F[t + 1, 1] = ((a * Pt)/(1 + (b * Pt))) * (exp(sig_r * rnorm(1, mean = 0, 
            sd = 1)))  #number of recruits with environmental stochasticity
        Nt_F[t + 1, 2:ncls] = sx * Nt_F[t, 1:(ncls - 1)]  #number of age classes 2-5
    }
    return(Nt_F)
}
~~~~

Run model by calling function

~~~~ {.r}
Nt_F = AgeStructMatrix_F(sx, a, b, tf, N0)
~~~~

Plot of time series with all 5 age classes

~~~~ {.r}
matplot(1:tf, Nt_F, type = "l", xlab = "Time", ylab = "Population size", main = "Age-structured model with fishing")
~~~~

![](/assets/old-blog-stuff/ageclassplot.png)

Export text file for plot with age classes

~~~~ {.r}
colnames(Nt_F) <- c("Recruits", "Age2", "Age3", "Age4", "Age5")  #Rename columns
write.table(Nt_F, "~/Desktop/Nt_F.txt", col.names = TRUE, row.names = FALSE, 
    quote = FALSE, sep = ",")  #comma separated
~~~~

Or plot of time series for total population

~~~~ {.r}
Nt_F_totals = rowSums(Nt_F)
plot(c(1:tf), Nt_F_totals, type = "l", xlab = "Time", ylab = "Population size", 
    col = "blue")
~~~~

![](/assets/old-blog-stuff/totalpopplot.png)

Export text file for plot with total population

~~~~ {.r}
write.table(Nt_F_totals, "~/Desktop/Nt_F_totals.txt", col.names = FALSE, row.names = FALSE, 
    quote = FALSE, sep = ",")
~~~~

Stability analysis of deterministic population model
----------------------------------------------------

This assumes that the partial differential equations that make up the
Jacobian matrix have been determined analytically. Below are the
parameters that were associated with my age-structured salmon model with
fishing. I can compare the stability of the population with fishing to
that with no fishing

~~~~ {.r}
e <- 0.1056
l <- 0.1056
s <- 0.28  #survival with fishing
s_noF <- 0.85  #survival with no fishing
c <- 1/((e * (s^2) + (1 - e) * (1 - l) * (s^3) + (1 - e) * l * (s^4)))
c_noF <- 1/((e * (s_noF^2) + (1 - e) * (1 - l) * (s_noF^3) + (1 - e) * l * (s_noF^4)))
alpha <- 60
beta <- 0.00017
~~~~

Fishing Jacobian

~~~~ {.r}
one_F <- c(0, 0, ((alpha * e)/(1 + (1/(2 * c)) * (-c + alpha + sqrt((c - alpha)^2)))^2), 
    ((alpha * (1 - l))/(1 + (1/(2 * c)) * (-c + alpha + sqrt((c - alpha)^2)))^2), 
    (alpha/(1 + (1/(2 * c)) * (-c + alpha + sqrt((c - alpha)^2)))^2))
two_F <- c(s, 0, 0, 0, 0)
three_F <- c(0, s, 0, 0, 0)
four_F <- c(0, 0, ((1 - e) * s), 0, 0)
five_F <- c(0, 0, 0, (l * s), 0)
jacobian_F <- rbind(one_F, two_F, three_F, four_F, five_F)
jacobian_F
~~~~

    #         [,1] [,2]   [,3]     [,4]  [,5]
    # one_F   0.00 0.00 2.5214 21.35558 23.88
    # two_F   0.28 0.00 0.0000  0.00000  0.00
    # three_F 0.00 0.28 0.0000  0.00000  0.00
    # four_F  0.00 0.00 0.2504  0.00000  0.00
    # five_F  0.00 0.00 0.0000  0.02957  0.00

Fishing Eigenvalues

~~~~ {.r}
ev_F <- eigen(jacobian_F)
ev1_F = c(Re(ev_F$values[1]), Im(ev_F$values[1]))
ev2_F = c(Re(ev_F$values[2]), Im(ev_F$values[2]))
ev3_F = c(Re(ev_F$values[3]), Im(ev_F$values[3]))
ev4_F = c(Re(ev_F$values[4]), Im(ev_F$values[4]))
ev5_F = c(Re(ev_F$values[5]), Im(ev_F$values[5]))
~~~~

No Fishing Jacobian

~~~~ {.r}
one_noF <- c(0, 0, ((alpha * e)/(1 + (1/(2 * c_noF)) * (-c_noF + alpha + sqrt((c_noF - 
    alpha)^2)))^2), ((alpha * (1 - l))/(1 + (1/(2 * c_noF)) * (-c_noF + alpha + 
    sqrt((c_noF - alpha)^2)))^2), (alpha/(1 + (1/(2 * c_noF)) * (-c_noF + alpha + 
    sqrt((c_noF - alpha)^2)))^2))
two_noF <- c(s_noF, 0, 0, 0, 0)
three_noF <- c(0, s_noF, 0, 0, 0)
four_noF <- c(0, 0, ((1 - e) * s_noF), 0, 0)
five_noF <- c(0, 0, 0, (l * s_noF), 0)
jacobian_noF <- rbind(one_noF, two_noF, three_noF, four_noF, five_noF)
jacobian_noF
~~~~

    #           [,1] [,2]     [,3]    [,4]   [,5]
    # one_noF   0.00 0.00 0.004625 0.03917 0.0438
    # two_noF   0.85 0.00 0.000000 0.00000 0.0000
    # three_noF 0.00 0.85 0.000000 0.00000 0.0000
    # four_noF  0.00 0.00 0.760240 0.00000 0.0000
    # five_noF  0.00 0.00 0.000000 0.08976 0.0000

No Fishing Eigenvalues

~~~~ {.r}
ev_noF <- eigen(jacobian_noF)
ev1_noF = c(Re(ev_noF$values[1]), Im(ev_noF$values[1]))
ev2_noF = c(Re(ev_noF$values[2]), Im(ev_noF$values[2]))
ev3_noF = c(Re(ev_noF$values[3]), Im(ev_noF$values[3]))
ev4_noF = c(Re(ev_noF$values[4]), Im(ev_noF$values[4]))
ev5_noF = c(Re(ev_noF$values[5]), Im(ev_noF$values[5]))

# Setup for plot, just remember to expand the plot interface first
library(plotrix)  #load plotrix
~~~~

Plot the eigenvalues with legend to compare stability of both
deterministic models

~~~~ {.r}
layout(matrix(c(1, 0, 2, 0, 3, 0), 2, 3, byrow = TRUE))  #Layout with 2 rows, 3 columns,
# the matrix tells you the number of the figure in each location. Since
# the layout is byrow, it fills the first row first and then the 2nd row
# no fishing plot
plot(ev1_noF[1], ev1_noF[2], type = "p", pch = 0, cex = 2, xlab = "Real", ylab = "Imaginary", 
    xlim = c(-1.25, 1.25), ylim = c(-1.25, 1.25))
title("No fishing", adj = 0)  #plot dominant eigenvalue, with x-coordinate as real part and y-coordinate as imaginary part
draw.circle(0, 0, radius = 1, border = "black", lty = 1, lwd = 1)  #draw unit circle
points(ev2_noF[1], ev2_noF[2], pch = 1, cex = 2)  #2nd eigenvalue
points(ev3_noF[1], ev3_noF[2], pch = 2, cex = 2)  #3rd eigenvalue
points(ev4_noF[1], ev4_noF[2], pch = 6, cex = 2)  #4th eigenvalue
points(ev5_noF[1], ev5_noF[2], pch = 5, cex = 2)  #5th eigenvalue
abline(a = NULL, b = NULL, h = 0, lty = 3)
abline(a = NULL, b = NULL, v = 0, lty = 3)

# fishing plot
plot(ev1_F[1], ev1_F[2], type = "p", pch = 0, cex = 2, xlab = "Real", ylab = "Imaginary", 
    xlim = c(-1.25, 1.25), ylim = c(-1.25, 1.25))
title("Fishing", adj = 0)
draw.circle(0, 0, radius = 1, border = "black", lty = 1, lwd = 1)
points(ev2_F[1], ev2_F[2], pch = 1, cex = 2)
points(ev3_F[1], ev3_F[2], pch = 2, cex = 2)
points(ev4_F[1], ev4_F[2], pch = 6, cex = 2)
points(ev5_F[1], ev5_F[2], pch = 5, cex = 2)
abline(a = NULL, b = NULL, h = 0, lty = 3)
abline(a = NULL, b = NULL, v = 0, lty = 3)

# Legend
plot(1:10, type = "n", axes = FALSE, xlab = "", ylab = "", frame.plot = TRUE)
title("Legend", adj = 0)
text(6.5, 9.5, expression(lambda[1]), cex = 1.2)
text(6.5, 7.5, expression(lambda[2]), cex = 1.2)
text(6.5, 5.5, expression(lambda[3]), cex = 1.2)
text(6.5, 3.5, expression(lambda[4]), cex = 1.2)
text(6.5, 1.5, expression(lambda[5]), cex = 1.2)
points(4.5, 9.5, pch = 0, cex = 1.3)
points(4.5, 7.5, pch = 1, cex = 1.3)
points(4.5, 5.5, pch = 2, cex = 1.3)
points(4.5, 3.5, pch = 6, cex = 1.3)
points(4.5, 1.5, pch = 5, cex = 1.3)
~~~~

![](/assets/old-blog-stuff/ploteigenvalues.png)

      </div>
      <hr>
      
      <a href="/archives/2012-11-28-lab-meeting-presentation-outline/"> &larr;&nbsp;A multi-species, age-structured model for forest disease</a> |
      
      <a href="//blog/#2012">All posts</a>
      
      | <a href="/archives/2012-12-17-quals-reading-list/">Qualifying Exam Reading List&nbsp;&rarr;</a>
      
    </div>
    <div class="is-col is-30"></div>

  </div>
</div>



<footer id="footer" class="is-hidden-print">
  <div class="wrapper">
    <div class="is-row .is-small is-muted">
      <div class="is-col is-33">
        <h3>About</h3>
        <em>
          <p>This is my personal website. Nothing here is endorsed by my employer or organizations I am part of.</p>
          <p>Content on this site is released under a
            <a href="https://creativecommons.org/licenses/by/4.0/legalcode">CC-BY 4.0 license.</a>
            Source code of the site is provided under the <a href="https://opensource.org/licenses/MIT">MIT license</a>
            and may be reused without restriction.</p>
          <p>Huge thanks to Noam Ross for the beautifully designed website and detailed instruction on how to built it <a href="https://www.noamross.net/2019/08/09/a-new-website/">here</a>.</p>
        </em>
      </div>
      <div class="is-col is-33">
        <h3 id="connect">Connect</h3>
        <ul class="fa-ul">
          <li><i class="fa-li fas fa-briefcase fa-fw"></i>3700 Hamilton Walk, Philadelphia, PA 19104</li>
          <li><i class="fa-li fas fa-envelope fa-fw"></i><a href="mailto:grixor@gmail.com">grixor@gmail.com</a></li>
          <li><a href="https://orcid.org/0000-0003-3737-6565"><i class="fa-li ai ai-orcid"></i></a><a href="https://orcid.org/0000-0003-3737-6565">0000-0003-3737-6565</a></li>
          <li><a href="https://scholar.google.com/citations?user=OMpJVfsAAAAJ&hl=en"><i class="fa-li ai ai-google-scholar"></i></a><a href="https://scholar.google.com/citations?user=OMpJVfsAAAAJ">Google Scholar</a></li>
          <li><a href="https://twitter.com/trang1618"><i class="fa-li fab fa-twitter fa-fw"></i></a><a href="https://twitter.com/trang1618">@trang1618</a></li>
          <li><a href="https://github.com/trang1618"><i class="fa-li fab fa-github fa-fw"></i></a><a href="https://github.com/trang1618">github.com/trang1618</a>
          <li><a href="https://slides.com/trang1618"><i class="fa-li fas fa-object-ungroup fa-fw"></i></a><a href="https://slides.com/trang1618">slides.com/trang1618</a>
        </ul>
      </div>
      <div class="is-col is-33">
        <h3 id="subscribe">Subscribe</h3>
        <em><p>Follow me on Twitter at <a href="https://twitter.com/trang1618">@trang1618</a> where I'll update you if anything is posted.</p></em>
        <h3 id="search">Search</h3>
        <nav class="is-push-right is-left-mobile" class="is-hidden-mobile">
					<form method="get" action="https://duckduckgo.com/">
      <input type="search" name="q" maxlength="255" placeholder="Search on site">
      <input type="hidden" name="sites" value="www.trang1618.github.io" />
      <input type="hidden" name="ka" value="Alegreya" />
      <input type="hidden" name="k7" value="#faf8f8" />
      <input type="hidden" name="kj" value="#b33" />
      <input type="hidden" name="ky" value="#fafafa" />
      <input type="hidden" name="kx" value="b" />
      <input type="hidden" name="ko" value="-1" />
      <input type="hidden" name="k1" value="-1" />
      <input type="hidden" name="kt" value="Alegreya Sans" />
</form>
				</nav>
      </div>
    </div>
  </div>
</footer>

<script type="text/javascript" src="/assets/js/kube.js"></script>
<script>
  $K.dom(window).on('load', $K.init);
</script>


</body>
</html>
